<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EduPlay - Plataforma Educativa Completa</title>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Comic Sans MS', cursive, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow-x: hidden;
        }

        .container {
            max-width: 1400px;
            width: 95%;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            overflow: hidden;
            backdrop-filter: blur(10px);
        }

        /* Notification Styles */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 25px;
            border-radius: 15px;
            color: white;
            font-weight: bold;
            z-index: 10000;
            animation: slideInRight 0.5s ease;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
        }

        .notification.success {
            background: linear-gradient(135deg, #00b894 0%, #00a085 100%);
        }

        .notification.error {
            background: linear-gradient(135deg, #e17055 0%, #d63031 100%);
        }

        .notification.info {
            background: linear-gradient(135deg, #74b9ff 0%, #0984e3 100%);
        }

        @keyframes slideInRight {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        /* Login Styles */
        .login-screen {
            padding: 60px;
            text-align: center;
            background: linear-gradient(135deg, #ff9a56 0%, #ff6b6b 100%);
            color: white;
            position: relative;
            overflow: hidden;
        }

        .login-screen::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255, 255, 255, 0.1) 1px, transparent 1px);
            background-size: 50px 50px;
            animation: float 6s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px) rotate(0deg); }
            50% { transform: translateY(-20px) rotate(180deg); }
        }

        .login-form {
            background: rgba(255, 255, 255, 0.95);
            padding: 50px;
            border-radius: 25px;
            margin: 40px auto;
            max-width: 550px;
            color: #2d3436;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255, 255, 255, 0.2);
            position: relative;
            z-index: 2;
        }

        .form-group {
            margin: 25px 0;
            text-align: left;
        }

        .form-group label {
            display: block;
            margin-bottom: 10px;
            font-weight: bold;
            color: #2d3436;
            font-size: 1.1em;
        }

        .form-group input, .form-group select {
            width: 100%;
            padding: 18px;
            border: 3px solid #ddd;
            border-radius: 15px;
            font-size: 1.1em;
            font-family: inherit;
            transition: all 0.3s ease;
        }

        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: #74b9ff;
            box-shadow: 0 0 20px rgba(116, 185, 255, 0.4);
            transform: translateY(-2px);
        }

        .login-btn, .register-btn {
            width: 100%;
            padding: 18px;
            border: none;
            border-radius: 15px;
            font-size: 1.3em;
            font-weight: bold;
            cursor: pointer;
            margin: 15px 0;
            transition: all 0.4s ease;
            position: relative;
            overflow: hidden;
        }

        .login-btn {
            background: linear-gradient(135deg, #00b894 0%, #00a085 100%);
            color: white;
            box-shadow: 0 8px 25px rgba(0, 184, 148, 0.4);
        }

        .register-btn {
            background: linear-gradient(135deg, #74b9ff 0%, #0984e3 100%);
            color: white;
            box-shadow: 0 8px 25px rgba(116, 185, 255, 0.4);
        }

        .login-btn:hover, .register-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.3);
        }

        /* Dashboard Styles */
        .dashboard {
            display: none;
            animation: fadeIn 0.6s ease;
        }

        .dashboard.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .header {
            background: linear-gradient(135deg, #ff9a56 0%, #ff6b6b 100%);
            color: white;
            padding: 40px;
            position: relative;
            overflow: hidden;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header::before {
            content: 'üéÆüåüüéØüöÄ';
            position: absolute;
            top: 15px;
            right: 30px;
            font-size: 28px;
            animation: bounce 3s infinite;
            opacity: 0.7;
        }

        .user-info {
            background: rgba(255, 255, 255, 0.25);
            padding: 20px 30px;
            border-radius: 20px;
            backdrop-filter: blur(15px);
            display: flex;
            align-items: center;
            gap: 20px;
            border: 2px solid rgba(255, 255, 255, 0.1);
        }

        .user-avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, #ffeaa7 0%, #fdcb6e 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8em;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
        }

        .logout-btn {
            background: rgba(255, 255, 255, 0.2);
            border: 2px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 12px 24px;
            border-radius: 15px;
            cursor: pointer;
            font-size: 1.1em;
            transition: all 0.3s ease;
        }

        .logout-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }

        .stats-bar {
            background: linear-gradient(135deg, #ffeaa7 0%, #fab1a0 100%);
            padding: 30px;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 25px;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.9);
            padding: 30px;
            border-radius: 20px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
            transition: all 0.3s ease;
            border: 2px solid rgba(255, 255, 255, 0.3);
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
        }

        .stat-number {
            font-size: 2.5em;
            font-weight: bold;
            color: #00b894;
            margin-bottom: 10px;
        }

        .stat-label {
            color: #636e72;
            font-size: 1.1em;
            font-weight: 600;
        }

        .games-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 25px;
            padding: 40px;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
        }

        .game-card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
            transition: all 0.4s ease;
            cursor: pointer;
            border: 3px solid transparent;
            position: relative;
            overflow: hidden;
            backdrop-filter: blur(10px);
        }

        .game-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #ff6b6b, #4ecdc4, #45b7d1, #96ceb4);
            transform: scaleX(0);
            transition: transform 0.3s ease;
        }

        .game-card:hover::before {
            transform: scaleX(1);
        }

        .game-card:hover {
            transform: translateY(-10px) scale(1.02);
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.2);
            border-color: #74b9ff;
        }

        .game-card.completed::after {
            content: 'üèÜ';
            position: absolute;
            top: 15px;
            right: 15px;
            font-size: 1.8em;
            animation: pulse 2s infinite;
        }

        .game-icon {
            font-size: 3.5em;
            text-align: center;
            margin-bottom: 20px;
            animation: bounce 2s infinite;
        }

        .game-title {
            font-size: 1.4em;
            font-weight: bold;
            color: #2d3436;
            margin-bottom: 15px;
            text-align: center;
        }

        .game-description {
            color: #636e72;
            text-align: center;
            line-height: 1.6;
            margin-bottom: 20px;
            font-size: 1.05em;
        }

        .game-progress {
            background: #e9ecef;
            height: 12px;
            border-radius: 6px;
            overflow: hidden;
            margin-top: 20px;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .game-progress-bar {
            background: linear-gradient(135deg, #00b894 0%, #00a085 100%);
            height: 100%;
            transition: width 0.8s ease;
            border-radius: 6px;
            position: relative;
        }

        .game-progress-bar::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        .game-stats {
            display: flex;
            justify-content: space-between;
            margin-top: 15px;
            font-size: 0.95em;
            color: #74b9ff;
            font-weight: 600;
        }

        .difficulty-badge {
            position: absolute;
            top: 20px;
            left: 20px;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .stage-badge {
            position: absolute;
            top: 20px;
            right: 20px;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            background: linear-gradient(135deg, #74b9ff, #0984e3);
            color: white;
        }

        .difficulty-easy { 
            background: linear-gradient(135deg, #00b894, #00a085); 
            color: white; 
        }
        .difficulty-medium { 
            background: linear-gradient(135deg, #fdcb6e, #e17055); 
            color: white; 
        }
        .difficulty-hard { 
            background: linear-gradient(135deg, #e17055, #d63031); 
            color: white; 
        }

        /* Game Area Styles */
        .game-area {
            display: none;
            padding: 40px;
            min-height: 700px;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
        }

        .game-area.active {
            display: block;
            animation: slideInLeft 0.6s ease;
        }

        @keyframes slideInLeft {
            from { opacity: 0; transform: translateX(-30px); }
            to { opacity: 1; transform: translateX(0); }
        }

        .game-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 40px;
            flex-wrap: wrap;
            gap: 20px;
        }

        .back-btn {
            background: linear-gradient(135deg, #a29bfe 0%, #6c5ce7 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            font-size: 1.2em;
            cursor: pointer;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
            transition: all 0.3s ease;
            font-weight: 600;
        }

        .back-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 35px rgba(0, 0, 0, 0.3);
        }

        .game-score {
            background: linear-gradient(135deg, #ffeaa7 0%, #fdcb6e 100%);
            padding: 20px 35px;
            border-radius: 25px;
            font-size: 1.3em;
            font-weight: bold;
            color: #2d3436;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
            border: 2px solid rgba(255, 255, 255, 0.3);
        }

        .stage-selector {
            background: linear-gradient(135deg, #a29bfe 0%, #6c5ce7 100%);
            padding: 20px 35px;
            border-radius: 25px;
            color: white;
            border: none;
            font-size: 1.1em;
            cursor: pointer;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
            transition: all 0.3s ease;
        }

        .stage-selector:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 35px rgba(0, 0, 0, 0.3);
        }

        .game-instructions {
            background: linear-gradient(135deg, #e17055 0%, #d63031 100%);
            color: white;
            padding: 25px;
            border-radius: 20px;
            margin-bottom: 40px;
            text-align: center;
            font-size: 1.3em;
            font-weight: 600;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }

        /* Game Grid */
        .game-grid {
            display: grid;
            gap: 20px;
            max-width: 700px;
            margin: 0 auto;
        }

        .puzzle-grid {
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            max-width: 600px;
        }

        .memory-grid {
            grid-template-columns: repeat(4, 1fr);
            max-width: 500px;
        }

        .numbers-grid {
            grid-template-columns: repeat(5, 1fr);
        }

        .colors-grid {
            grid-template-columns: repeat(3, 1fr);
        }

        .shapes-grid {
            grid-template-columns: repeat(3, 1fr);
        }

        .letters-grid {
            grid-template-columns: repeat(4, 1fr);
        }

        .game-btn {
            aspect-ratio: 1;
            border: none;
            border-radius: 18px;
            font-size: 1.6em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            background: linear-gradient(135deg, #ffeaa7 0%, #fdcb6e 100%);
            color: #2d3436;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
            min-height: 80px;
            position: relative;
            overflow: hidden;
        }

        .game-btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            transition: all 0.3s ease;
        }

        .game-btn:hover::before {
            width: 100%;
            height: 100%;
        }

        .game-btn:hover {
            transform: scale(1.08);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.25);
        }

        .game-btn.correct {
            background: linear-gradient(135deg, #00b894 0%, #00a085 100%);
            color: white;
            animation: correctPulse 0.8s ease;
        }

        .game-btn.incorrect {
            background: linear-gradient(135deg, #e17055 0%, #d63031 100%);
            color: white;
            animation: shake 0.6s ease;
        }

        .game-btn.revealed {
            background: linear-gradient(135deg, #74b9ff 0%, #0984e3 100%);
            color: white;
        }

        /* Question Display */
        .question-display {
            background: rgba(255, 255, 255, 0.9);
            padding: 30px;
            border-radius: 20px;
            margin: 20px 0;
            text-align: center;
            font-size: 1.5em;
            font-weight: 600;
            color: #2d3436;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 15000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(8px);
        }

        .modal-content {
            background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
            margin: 10% auto;
            padding: 50px;
            border-radius: 25px;
            width: 90%;
            max-width: 600px;
            text-align: center;
            box-shadow: 0 25px 80px rgba(0, 0, 0, 0.4);
            border: 2px solid rgba(255, 255, 255, 0.2);
            animation: modalSlideIn 0.5s ease;
        }

        @keyframes modalSlideIn {
            from { opacity: 0; transform: translateY(-50px) scale(0.9); }
            to { opacity: 1; transform: translateY(0) scale(1); }
        }

        .modal-icon {
            font-size: 5em;
            margin-bottom: 25px;
            animation: bounce 1s infinite;
        }

        .modal-title {
            font-size: 2.2em;
            color: #2d3436;
            margin-bottom: 20px;
            font-weight: bold;
        }

        .modal-text {
            color: #636e72;
            margin-bottom: 40px;
            font-size: 1.2em;
        }

        .modal-btn {
            background: linear-gradient(135deg, #00b894 0%, #00a085 100%);
            color: white;
            border: none;
            padding: 18px 35px;
            border-radius: 15px;
            font-size: 1.2em;
            cursor: pointer;
            margin: 0 15px;
            transition: all 0.3s ease;
            font-weight: 600;
        }

        .modal-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        /* Stage Selection Modal */
        .stage-modal {
            display: none;
            position: fixed;
            z-index: 16000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(8px);
        }

        .stage-modal-content {
            background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
            margin: 5% auto;
            padding: 40px;
            border-radius: 25px;
            width: 90%;
            max-width: 800px;
            text-align: center;
            box-shadow: 0 25px 80px rgba(0, 0, 0, 0.4);
            border: 2px solid rgba(255, 255, 255, 0.2);
            animation: modalSlideIn 0.5s ease;
        }

        .stages-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }

        .stage-btn {
            background: linear-gradient(135deg, #74b9ff 0%, #0984e3 100%);
            color: white;
            border: none;
            padding: 20px 15px;
            border-radius: 15px;
            font-size: 1.1em;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            position: relative;
        }

        .stage-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        .stage-btn.completed::after {
            content: '‚úì';
            position: absolute;
            top: 5px;
            right: 5px;
            background: #00b894;
            color: white;
            border-radius: 50%;
            width: 25px;
            height: 25px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8em;
        }

        .stage-btn:disabled {
            background: #bdc3c7;
            cursor: not-allowed;
            opacity: 0.6;
        }

        .stage-btn:disabled:hover {
            transform: none;
            box-shadow: none;
        }

        /* Color specific styles */
        .color-red { background: linear-gradient(135deg, #e74c3c, #c0392b) !important; color: white !important; }
        .color-blue { background: linear-gradient(135deg, #3498db, #2980b9) !important; color: white !important; }
        .color-green { background: linear-gradient(135deg, #27ae60, #229954) !important; color: white !important; }
        .color-yellow { background: linear-gradient(135deg, #f1c40f, #f39c12) !important; color: white !important; }
        .color-purple { background: linear-gradient(135deg, #9b59b6, #8e44ad) !important; color: white !important; }
        .color-orange { background: linear-gradient(135deg, #e67e22, #d35400) !important; color: white !important; }

        /* Progress bar styles */
        .progress-bar {
            background: #e9ecef;
            height: 12px;
            border-radius: 6px;
            overflow: hidden;
            margin: 15px 0;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .progress-fill {
            background: linear-gradient(135deg, #00b894 0%, #00a085 100%);
            height: 100%;
            transition: width 0.8s ease;
            border-radius: 6px;
        }

        /* Animations */
        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-15px); }
            60% { transform: translateY(-8px); }
        }

        @keyframes correctPulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.15); }
            100% { transform: scale(1); }
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-8px); }
            20%, 40%, 60%, 80% { transform: translateX(8px); }
        }

        @keyframes pulse {
            0% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.1); opacity: 0.7; }
            100% { transform: scale(1); opacity: 1; }
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .container {
                width: 98%;
                margin: 10px;
            }
            
            .header {
                flex-direction: column;
                gap: 20px;
                text-align: center;
                padding: 30px 20px;
            }
            
            .stats-bar {
                grid-template-columns: repeat(2, 1fr);
                padding: 20px;
            }
            
            .games-container {
                grid-template-columns: 1fr;
                padding: 25px;
            }
            
            .game-header {
                flex-direction: column;
                align-items: stretch;
            }

            .numbers-grid {
                grid-template-columns: repeat(3, 1fr);
            }

            .colors-grid, .shapes-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .modal-content {
                margin: 5% auto;
                padding: 30px 20px;
            }

            .login-form {
                padding: 30px;
                margin: 20px;
            }

            .stages-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 480px) {
            .game-btn {
                font-size: 1.3em;
                min-height: 60px;
            }

            .modal-content {
                width: 95%;
                padding: 25px 15px;
            }

            .login-screen {
                padding: 30px 15px;
            }

            .stages-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Login Screen -->
        <div id="login-screen" class="login-screen">
            <h1>üéÆ EduPlay - Plataforma Educativa üåü</h1>
            <p style="font-size: 1.2em; margin: 20px 0;">¬°Bienvenido al mundo del aprendizaje divertido!</p>
            
            <div class="login-form" id="login-form">
                <h2>üöÄ Iniciar Sesi√≥n</h2>
                <div class="form-group">
                    <label for="login-username">Nombre de Usuario:</label>
                    <input type="text" id="login-username" placeholder="Ingresa tu nombre de usuario">
                </div>
                <button class="login-btn" onclick="app.login()">üöÄ Ingresar</button>
                <button class="register-btn" onclick="app.showRegister()">üë§ Crear Nueva Cuenta</button>
            </div>

            <div class="login-form" id="register-form" style="display: none;">
                <h2>‚ú® Crear Nueva Cuenta</h2>
                <div class="form-group">
                    <label for="reg-name">Nombre Completo:</label>
                    <input type="text" id="reg-name" placeholder="Tu nombre completo">
                </div>
                <div class="form-group">
                    <label for="reg-username">Nombre de Usuario:</label>
                    <input type="text" id="reg-username" placeholder="Elige un nombre de usuario">
                </div>
                <div class="form-group">
                    <label for="reg-age">Edad:</label>
                    <input type="number" id="reg-age" min="5" max="18" placeholder="Tu edad">
                </div>
                <div class="form-group">
                    <label for="reg-grade">Grado Escolar:</label>
                    <select id="reg-grade">
                        <option value="">Selecciona tu grado</option>
                        <option value="1">1¬∞ Primaria</option>
                        <option value="2">2¬∞ Primaria</option>
                        <option value="3">3¬∞ Primaria</option>
                        <option value="4">4¬∞ Primaria</option>
                        <option value="5">5¬∞ Primaria</option>
                        <option value="6">6¬∞ Primaria</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="reg-avatar">Elige tu Avatar:</label>
                    <select id="reg-avatar">
                        <option value="üßë‚Äçüéì">üë®‚Äçüéì Estudiante</option>
                        <option value="ü¶∏">ü¶∏ Superh√©roe</option>
                        <option value="üê±">üê± Gatito</option>
                        <option value="ü¶Ñ">ü¶Ñ Unicornio</option>
                        <option value="ü§ñ">ü§ñ Robot</option>
                        <option value="üêµ">üêµ Monito</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="reg-fund">Monedas iniciales:</label>
                    <input type="number" id="reg-fund" min="0" value="100" placeholder="Cantidad de monedas">
                </div>
                <button class="register-btn" onclick="app.register()">‚ú® Crear Cuenta</button>
                <button class="login-btn" onclick="app.showLogin()">‚Üê Volver al Login</button>
            </div>
        </div>

        <!-- Dashboard -->
        <div id="dashboard" class="dashboard">
            <div class="header">
                <div>
                    <h1>üéÆ EduPlay Dashboard üåü</h1>
                    <p>¬°Sigue aprendiendo y divirti√©ndote!</p>
                </div>
                <div class="user-info">
                    <div class="user-avatar" id="user-avatar">üßë‚Äçüéì</div>
                    <div>
                        <div id="user-name-display">Usuario</div>
                        <div id="user-grade-display">Grado: 1¬∞</div>
                        <div id="user-fund-display">üíé 100 monedas</div>
                    </div>
                    <button class="logout-btn" onclick="app.logout()">üö™ Salir</button>
                </div>
            </div>

            <div class="stats-bar">
                <div class="stat-card">
                    <div class="stat-number" id="total-score">0</div>
                    <div class="stat-label">Puntos Totales</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="games-completed">0</div>
                    <div class="stat-label">Juegos Completados</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="streak-days">0</div>
                    <div class="stat-label">D√≠as Consecutivos</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="level-display">1</div>
                    <div class="stat-label">Nivel Actual</div>
                </div>
            </div>

            <div class="games-container" id="games-container">
                <!-- Games will be loaded here -->
            </div>
        </div>

        <!-- Game Area -->
        <div id="game-area" class="game-area">
            <div class="game-header">
                <button class="back-btn" onclick="app.backToDashboard()">‚¨ÖÔ∏è Volver al Dashboard</button>
                <button class="stage-selector" onclick="app.showStageSelector()" id="stage-selector-btn">Etapa 1/15</button>
                <div class="game-score">
                    <span id="current-game-score">Puntos: 0</span>
                </div>
            </div>
            <div id="game-content"></div>
        </div>
    </div>

    <!-- Success Modal -->
    <div id="success-modal" class="modal">
        <div class="modal-content">
            <div class="modal-icon">üéâ</div>
            <div class="modal-title">¬°Excelente Trabajo!</div>
            <div class="modal-text" id="modal-message">¬°Has completado el juego exitosamente!</div>
            <button class="modal-btn" onclick="app.closeModal()">Continuar</button>
            <button class="modal-btn" onclick="app.playAgain()">Jugar de Nuevo</button>
            <button class="modal-btn" onclick="app.nextStage()">Siguiente Etapa</button>
        </div>
    </div>

    <!-- Stage Selection Modal -->
    <div id="stage-modal" class="stage-modal">
        <div class="stage-modal-content">
            <h2>Selecciona una Etapa</h2>
            <div class="stage-progress">
                <div>Progreso del juego</div>
                <div class="progress-bar">
                    <div class="progress-fill" id="game-progress-fill" style="width: 0%"></div>
                </div>
                <div id="stage-progress-text">0/15 etapas completadas</div>
            </div>
            <div class="stages-grid" id="stages-grid">
                <!-- Stages will be loaded here -->
            </div>
            <button class="modal-btn" onclick="app.closeStageModal()" style="margin-top: 20px;">Cerrar</button>
        </div>
    </div>

    <script>
        // ================================================
        // APLICACI√ìN EDUPLAY COMPLETA CON TODOS LOS JUEGOS
        // ================================================

        class EduPlayApp {
            constructor() {
                this.currentUser = null;
                this.currentGame = null;
                this.currentStage = 1;
                this.currentScore = 0;
                this.gameStartTime = null;
                this.gameState = {};
                
                // Base de datos completa de juegos por grado
                this.gameDatabase = this.initializeCompleteGameDatabase();
                
                this.init();
            }

            initializeCompleteGameDatabase() {
                return {
                    1: [ // 1¬∞ Primaria (6-7 a√±os)
                        {
                            id: 1,
                            name: "Puzzles Num√©ricos",
                            description: "Completa puzzles con n√∫meros del 1 al 10",
                            icon: "üß©",
                            category: "matem√°ticas",
                            difficulty: "easy",
                            stages: 15,
                            gameType: "puzzle"
                        },
                        {
                            id: 2,
                            name: "Memoria de N√∫meros",
                            description: "Memoriza secuencias de n√∫meros",
                            icon: "üß†",
                            category: "memoria",
                            difficulty: "easy",
                            stages: 15,
                            gameType: "memory"
                        },
                        {
                            id: 3,
                            name: "Suma B√°sica",
                            description: "Aprende a sumar con objetos visuales",
                            icon: "‚ûï",
                            category: "matem√°ticas",
                            difficulty: "easy",
                            stages: 15,
                            gameType: "math"
                        },
                        {
                            id: 4,
                            name: "Colores y Formas",
                            description: "Identifica y relaciona colores y formas",
                            icon: "üé®",
                            category: "l√≥gica",
                            difficulty: "easy",
                            stages: 15,
                            gameType: "colors"
                        },
                        {
                            id: 5,
                            name: "Secuencias Simples",
                            description: "Completa secuencias l√≥gicas b√°sicas",
                            icon: "üî¢",
                            category: "l√≥gica",
                            difficulty: "easy",
                            stages: 15,
                            gameType: "sequence"
                        },
                        {
                            id: 6,
                            name: "Letras y Sonidos",
                            description: "Asocia letras con sus sonidos",
                            icon: "üî§",
                            category: "lenguaje",
                            difficulty: "easy",
                            stages: 15,
                            gameType: "letters"
                        },
                        {
                            id: 7,
                            name: "Cuenta Objetos",
                            description: "Cuenta objetos del 1 al 20",
                            icon: "üî¢",
                            category: "matem√°ticas",
                            difficulty: "easy",
                            stages: 15,
                            gameType: "counting"
                        }
                    ],
                    2: [ // 2¬∞ Primaria (7-8 a√±os)
                        {
                            id: 8,
                            name: "Sumas y Restas",
                            description: "Operaciones b√°sicas hasta el 100",
                            icon: "üßÆ",
                            category: "matem√°ticas",
                            difficulty: "easy",
                            stages: 15,
                            gameType: "math"
                        },
                        {
                            id: 9,
                            name: "Memoria Visual",
                            description: "Juegos de memoria con im√°genes",
                            icon: "üëÅÔ∏è",
                            category: "memoria",
                            difficulty: "easy",
                            stages: 15,
                            gameType: "memory"
                        },
                        {
                            id: 10,
                            name: "Patrones L√≥gicos",
                            description: "Identifica y completa patrones",
                            icon: "üîÑ",
                            category: "l√≥gica",
                            difficulty: "medium",
                            stages: 15,
                            gameType: "pattern"
                        },
                        {
                            id: 11,
                            name: "Palabras y S√≠labas",
                            description: "Forma palabras y cuenta s√≠labas",
                            icon: "üìù",
                            category: "lenguaje",
                            difficulty: "medium",
                            stages: 15,
                            gameType: "words"
                        },
                        {
                            id: 12,
                            name: "Comparar N√∫meros",
                            description: "Mayor, menor e igual hasta el 100",
                            icon: "‚öñÔ∏è",
                            category: "matem√°ticas",
                            difficulty: "medium",
                            stages: 15,
                            gameType: "comparison"
                        },
                        {
                            id: 13,
                            name: "Figuras Geom√©tricas",
                            description: "Reconoce formas geom√©tricas b√°sicas",
                            icon: "üìê",
                            category: "geometr√≠a",
                            difficulty: "medium",
                            stages: 15,
                            gameType: "shapes"
                        },
                        {
                            id: 14,
                            name: "Lectura de Reloj",
                            description: "Aprende las horas en punto y media",
                            icon: "üïê",
                            category: "tiempo",
                            difficulty: "medium",
                            stages: 15,
                            gameType: "time"
                        }
                    ],
                    3: [ // 3¬∞ Primaria (8-9 a√±os)
                        {
                            id: 15,
                            name: "Puzzle de Multiplicaciones",
                            description: "Aprende las tablas de multiplicar",
                            icon: "‚úñÔ∏è",
                            category: "matem√°ticas",
                            difficulty: "medium",
                            stages: 15,
                            gameType: "multiplication"
                        },
                        {
                            id: 16,
                            name: "Memoria de Figuras",
                            description: "Memoriza patrones geom√©tricos",
                            icon: "üî∫",
                            category: "memoria",
                            difficulty: "medium",
                            stages: 15,
                            gameType: "memory"
                        },
                        {
                            id: 17,
                            name: "C√°lculo Mental R√°pido",
                            description: "Resuelve operaciones mentalmente",
                            icon: "‚ö°",
                            category: "matem√°ticas",
                            difficulty: "medium",
                            stages: 15,
                            gameType: "mental_math"
                        },
                        {
                            id: 18,
                            name: "Puzzle de Fracciones",
                            description: "Introduce conceptos de fracciones",
                            icon: "üç∞",
                            category: "matem√°ticas",
                            difficulty: "medium",
                            stages: 15,
                            gameType: "fractions"
                        },
                        {
                            id: 19,
                            name: "Secuencias Num√©ricas",
                            description: "Encuentra patrones en n√∫meros",
                            icon: "üî¢",
                            category: "l√≥gica",
                            difficulty: "medium",
                            stages: 15,
                            gameType: "sequence"
                        },
                        {
                            id: 20,
                            name: "Rompecabezas de Palabras",
                            description: "Forma palabras con s√≠labas",
                            icon: "üß©",
                            category: "lenguaje",
                            difficulty: "medium",
                            stages: 15,
                            gameType: "word_puzzle"
                        },
                        {
                            id: 21,
                            name: "L√≥gica y Patrones",
                            description: "Resuelve puzzles l√≥gicos",
                            icon: "üéØ",
                            category: "l√≥gica",
                            difficulty: "medium",
                            stages: 15,
                            gameType: "logic"
                        },
                        {
                            id: 22,
                            name: "Aventuras Matem√°ticas",
                            description: "Explora conceptos matem√°ticos",
                            icon: "üó∫Ô∏è",
                            category: "matem√°ticas",
                            difficulty: "medium",
                            stages: 15,
                            gameType: "adventure"
                        },
                        {
                            id: 23,
                            name: "Resuelve el Enigma",
                            description: "Acertijos y problemas l√≥gicos",
                            icon: "üïµÔ∏è",
                            category: "l√≥gica",
                            difficulty: "hard",
                            stages: 15,
                            gameType: "riddle"
                        },
                        {
                            id: 24,
                            name: "Crucigramas Num√©ricos",
                            description: "Completa crucigramas con n√∫meros",
                            icon: "üìã",
                            category: "matem√°ticas",
                            difficulty: "hard",
                            stages: 15,
                            gameType: "crossword"
                        }
                    ],
                    4: [ // 4¬∞ Primaria (9-10 a√±os)
                        {
                            id: 25,
                            name: "Multiplicaci√≥n y Divisi√≥n",
                            description: "Domina operaciones avanzadas",
                            icon: "‚ûó",
                            category: "matem√°ticas",
                            difficulty: "medium",
                            stages: 15,
                            gameType: "math_advanced"
                        },
                        {
                            id: 26,
                            name: "L√≥gica Matem√°tica",
                            description: "Problemas de razonamiento l√≥gico",
                            icon: "üß†",
                            category: "l√≥gica",
                            difficulty: "medium",
                            stages: 15,
                            gameType: "math_logic"
                        },
                        {
                            id: 27,
                            name: "Operaciones Mixtas",
                            description: "Combina diferentes operaciones",
                            icon: "üîÑ",
                            category: "matem√°ticas",
                            difficulty: "medium",
                            stages: 15,
                            gameType: "mixed_operations"
                        },
                        {
                            id: 28,
                            name: "Secuencias Geom√©tricas",
                            description: "Patrones con figuras geom√©tricas",
                            icon: "üìê",
                            category: "geometr√≠a",
                            difficulty: "medium",
                            stages: 15,
                            gameType: "geometry"
                        },
                        {
                            id: 29,
                            name: "Rompecabezas de Problemas",
                            description: "Resuelve problemas paso a paso",
                            icon: "üß©",
                            category: "matem√°ticas",
                            difficulty: "hard",
                            stages: 15,
                            gameType: "problem_solving"
                        },
                        {
                            id: 30,
                            name: "Sudoku para Ni√±os",
                            description: "Sudoku adaptado para estudiantes",
                            icon: "üî¢",
                            category: "l√≥gica",
                            difficulty: "hard",
                            stages: 15,
                            gameType: "sudoku"
                        },
                        {
                            id: 31,
                            name: "Aventuras con Decimales",
                            description: "Explora n√∫meros decimales",
                            icon: "üéØ",
                            category: "matem√°ticas",
                            difficulty: "hard",
                            stages: 15,
                            gameType: "decimals"
                        },
                        {
                            id: 32,
                            name: "Memoria de S√≠mbolos",
                            description: "Memoriza s√≠mbolos matem√°ticos",
                            icon: "üî£",
                            category: "memoria",
                            difficulty: "medium",
                            stages: 15,
                            gameType: "symbol_memory"
                        },
                        {
                            id: 33,
                            name: "Puzzle de Fracciones",
                            description: "Operaciones con fracciones",
                            icon: "üç∞",
                            category: "matem√°ticas",
                            difficulty: "hard",
                            stages: 15,
                            gameType: "fractions_advanced"
                        },
                        {
                            id: 34,
                            name: "Desaf√≠o Matem√°tico",
                            description: "Retos matem√°ticos complejos",
                            icon: "üèÜ",
                            category: "matem√°ticas",
                            difficulty: "hard",
                            stages: 15,
                            gameType: "math_challenge"
                        }
                    ],
                    5: [ // 5¬∞ Primaria (10-11 a√±os)
                        {
                            id: 35,
                            name: "Operaciones Avanzadas",
                            description: "Operaciones con n√∫meros grandes",
                            icon: "üî¢",
                            category: "matem√°ticas",
                            difficulty: "hard",
                            stages: 15,
                            gameType: "advanced_operations"
                        },
                        {
                            id: 36,
                            name: "Problemas Verbales",
                            description: "Resuelve problemas de la vida real",
                            icon: "üìñ",
                            category: "matem√°ticas",
                            difficulty: "hard",
                            stages: 15,
                            gameType: "word_problems"
                        },
                        {
                            id: 37,
                            name: "Laberinto de Fracciones",
                            description: "Navega usando fracciones",
                            icon: "üó∫Ô∏è",
                            category: "matem√°ticas",
                            difficulty: "hard",
                            stages: 15,
                            gameType: "fraction_maze"
                        },
                        {
                            id: 38,
                            name: "Puzzle de Decimales",
                            description: "Operaciones con decimales",
                            icon: "üéØ",
                            category: "matem√°ticas",
                            difficulty: "hard",
                            stages: 15,
                            gameType: "decimal_puzzle"
                        },
                        {
                            id: 39,
                            name: "Sudoku Intermedio",
                            description: "Sudoku de dificultad media",
                            icon: "üß©",
                            category: "l√≥gica",
                            difficulty: "hard",
                            stages: 15,
                            gameType: "sudoku_intermediate"
                        },
                        {
                            id: 40,
                            name: "Desaf√≠os L√≥gicos",
                            description: "Problemas de l√≥gica compleja",
                            icon: "üß†",
                            category: "l√≥gica",
                            difficulty: "hard",
                            stages: 15,
                            gameType: "logic_challenges"
                        },
                        {
                            id: 41,
                            name: "Crucigrama Matem√°tico",
                            description: "Crucigramas con operaciones",
                            icon: "üìã",
                            category: "matem√°ticas",
                            difficulty: "hard",
                            stages: 15,
                            gameType: "math_crossword"
                        },
                        {
                            id: 42,
                            name: "Matem√°tica en la Vida Real",
                            description: "Aplica matem√°ticas al mundo real",
                            icon: "üåç",
                            category: "matem√°ticas",
                            difficulty: "hard",
                            stages: 15,
                            gameType: "real_world_math"
                        },
                        {
                            id: 43,
                            name: "Desaf√≠o de Figuras",
                            description: "Problemas con geometr√≠a",
                            icon: "üìê",
                            category: "geometr√≠a",
                            difficulty: "hard",
                            stages: 15,
                            gameType: "geometry_challenge"
                        },
                        {
                            id: 44,
                            name: "Calcula y Avanza",
                            description: "Progresa resolviendo c√°lculos",
                            icon: "üéÆ",
                            category: "matem√°ticas",
                            difficulty: "hard",
                            stages: 15,
                            gameType: "calculate_advance"
                        }
                    ],
                    6: [ // 6¬∞ Primaria (11-12 a√±os)
                        {
                            id: 45,
                            name: "Desaf√≠os Algebraicos",
                            description: "Introducci√≥n al √°lgebra",
                            icon: "üìä",
                            category: "matem√°ticas",
                            difficulty: "hard",
                            stages: 15,
                            gameType: "algebra"
                        },
                        {
                            id: 46,
                            name: "L√≥gica y Estrategia",
                            description: "Juegos de estrategia compleja",
                            icon: "‚ôüÔ∏è",
                            category: "l√≥gica",
                            difficulty: "hard",
                            stages: 15,
                            gameType: "strategy"
                        },
                        {
                            id: 47,
                            name: "Puzzle de Porcentajes",
                            description: "Calcula porcentajes y proporciones",
                            icon: "üìä",
                            category: "matem√°ticas",
                            difficulty: "hard",
                            stages: 15,
                            gameType: "percentages"
                        },
                        {
                            id: 48,
                            name: "Operaciones Combinadas",
                            description: "Operaciones con m√∫ltiples pasos",
                            icon: "üîÑ",
                            category: "matem√°ticas",
                            difficulty: "hard",
                            stages: 15,
                            gameType: "combined_operations"
                        },
                        {
                            id: 49,
                            name: "Desaf√≠o de Medidas",
                            description: "Conversiones y medidas",
                            icon: "üìè",
                            category: "matem√°ticas",
                            difficulty: "hard",
                            stages: 15,
                            gameType: "measurements"
                        },
                        {
                            id: 50,
                            name: "Matem√°tica en el Mundo",
                            description: "Aplicaciones avanzadas",
                            icon: "üåç",
                            category: "matem√°ticas",
                            difficulty: "hard",
                            stages: 15,
                            gameType: "world_math"
                        },
                        {
                            id: 51,
                            name: "Juegos de Estrategia",
                            description: "Pensamiento estrat√©gico avanzado",
                            icon: "üéØ",
                            category: "l√≥gica",
                            difficulty: "hard",
                            stages: 15,
                            gameType: "strategy_games"
                        },
                        {
                            id: 52,
                            name: "Criptogramas Matem√°ticos",
                            description: "Descifra c√≥digos matem√°ticos",
                            icon: "üîê",
                            category: "matem√°ticas",
                            difficulty: "hard",
                            stages: 15,
                            gameType: "cryptograms"
                        },
                        {
                            id: 53,
                            name: "Puzzle de Proporciones",
                            description: "Resuelve proporciones complejas",
                            icon: "‚öñÔ∏è",
                            category: "matem√°ticas",
                            difficulty: "hard",
                            stages: 15,
                            gameType: "proportions"
                        },
                        {
                            id: 54,
                            name: "Desaf√≠o Final",
                            description: "El reto m√°s dif√≠cil de todos",
                            icon: "üëë",
                            category: "matem√°ticas",
                            difficulty: "hard",
                            stages: 15,
                            gameType: "final_challenge"
                        }
                    ]
                };
            }

            init() {
                this.loadUserData();
                this.showLoginScreen();
            }

            showLoginScreen() {
                document.getElementById('login-screen').style.display = 'block';
                document.getElementById('dashboard').classList.remove('active');
                document.getElementById('game-area').classList.remove('active');
            }

            showRegister() {
                document.getElementById('login-form').style.display = 'none';
                document.getElementById('register-form').style.display = 'block';
            }

            showLogin() {
                document.getElementById('login-form').style.display = 'block';
                document.getElementById('register-form').style.display = 'none';
            }

            login() {
                const username = document.getElementById('login-username').value.trim();
                
                if (!username) {
                    this.showNotification('Por favor ingresa un nombre de usuario', 'error');
                    return;
                }

                const userData = this.loadUserData(username);
                if (userData) {
                    this.currentUser = userData;
                    this.showDashboard();
                    this.showNotification(`¬°Bienvenido de vuelta, ${userData.name}!`, 'success');
                } else {
                    this.showNotification('Usuario no encontrado. ¬øQuieres crear una cuenta nueva?', 'error');
                }
            }

            register() {
                const name = document.getElementById('reg-name').value.trim();
                const username = document.getElementById('reg-username').value.trim();
                const age = parseInt(document.getElementById('reg-age').value);
                const grade = parseInt(document.getElementById('reg-grade').value);
                const avatar = document.getElementById('reg-avatar').value;
                const fund = parseInt(document.getElementById('reg-fund').value);

                if (!name || !username || !age || !grade) {
                    this.showNotification('Por favor completa todos los campos obligatorios', 'error');
                    return;
                }

                if (this.loadUserData(username)) {
                    this.showNotification('Este nombre de usuario ya existe', 'error');
                    return;
                }

                const userData = {
                    name: name,
                    username: username,
                    age: age,
                    grade: grade,
                    avatar: avatar,
                    coins: fund,
                    level: 1,
                    totalScore: 0,
                    gamesCompleted: 0,
                    streakDays: 0,
                    progress: {},
                    achievements: [],
                    lastLogin: new Date().toISOString()
                };

                this.saveUserData(userData);
                this.currentUser = userData;
                this.showDashboard();
                this.showNotification(`¬°Cuenta creada exitosamente, ${name}!`, 'success');
            }

            showDashboard() {
                document.getElementById('login-screen').style.display = 'none';
                document.getElementById('dashboard').classList.add('active');
                document.getElementById('game-area').classList.remove('active');
                
                this.updateUserDisplay();
                this.loadGamesForGrade();
            }

            updateUserDisplay() {
                if (!this.currentUser) return;

                document.getElementById('user-avatar').textContent = this.currentUser.avatar;
                document.getElementById('user-name-display').textContent = this.currentUser.name;
                document.getElementById('user-grade-display').textContent = `Grado: ${this.currentUser.grade}¬∞`;
                document.getElementById('user-fund-display').textContent = `üíé ${this.currentUser.coins} monedas`;
                document.getElementById('total-score').textContent = this.currentUser.totalScore;
                document.getElementById('games-completed').textContent = this.currentUser.gamesCompleted;
                document.getElementById('streak-days').textContent = this.currentUser.streakDays;
                document.getElementById('level-display').textContent = this.currentUser.level;
            }

            loadGamesForGrade() {
                const games = this.gameDatabase[this.currentUser.grade] || [];
                const container = document.getElementById('games-container');
                container.innerHTML = '';

                games.forEach(game => {
                    const progress = this.currentUser.progress[game.id] || { stage: 1, completed: false, bestScore: 0 };
                    const progressPercentage = (progress.stage - 1) / game.stages * 100;

                    const gameCard = document.createElement('div');
                    gameCard.className = `game-card ${progress.completed ? 'completed' : ''}`;
                    gameCard.onclick = () => this.startGame(game);

                    gameCard.innerHTML = `
                        <div class="difficulty-badge difficulty-${game.difficulty}">${game.difficulty}</div>
                        <div class="stage-badge">Etapa ${progress.stage}/${game.stages}</div>
                        <div class="game-icon">${game.icon}</div>
                        <div class="game-title">${game.name}</div>
                        <div class="game-description">${game.description}</div>
                        <div class="game-progress">
                            <div class="game-progress-bar" style="width: ${progressPercentage}%"></div>
                        </div>
                        <div class="game-stats">
                            <span>Categor√≠a: ${game.category}</span>
                            <span>Mejor: ${progress.bestScore} pts</span>
                        </div>
                    `;

                    container.appendChild(gameCard);
                });
            }

            startGame(game) {
                this.currentGame = game;
                const userProgress = this.currentUser.progress[game.id] || { stage: 1, completed: false, bestScore: 0 };
                this.currentStage = userProgress.stage;
                this.currentScore = 0;
                this.gameStartTime = Date.now();

                document.getElementById('dashboard').classList.remove('active');
                document.getElementById('game-area').classList.add('active');
                
                this.updateGameHeader();
                this.loadGameContent();
            }

            updateGameHeader() {
                document.getElementById('stage-selector-btn').textContent = `Etapa ${this.currentStage}/${this.currentGame.stages}`;
                document.getElementById('current-game-score').textContent = `Puntos: ${this.currentScore}`;
            }

            loadGameContent() {
                const content = document.getElementById('game-content');
                
                // Instrucciones del juego
                const instructions = this.getGameInstructions(this.currentGame.gameType, this.currentStage);
                content.innerHTML = `
                    <div class="game-instructions">${instructions}</div>
                    <div id="game-play-area"></div>
                `;

                // Cargar el juego espec√≠fico
                this.loadSpecificGame();
            }

            getGameInstructions(gameType, stage) {
                const instructions = {
                    puzzle: `Completa el puzzle num√©rico. Etapa ${stage}: N√∫meros del 1 al ${Math.min(10, stage + 2)}`,
                    memory: `Memoriza la secuencia y rep√≠tela. Etapa ${stage}: ${stage + 2} elementos`,
                    math: `Resuelve las operaciones matem√°ticas. Etapa ${stage}`,
                    colors: `Identifica y selecciona los colores correctos. Etapa ${stage}`,
                    sequence: `Completa la secuencia l√≥gica. Etapa ${stage}`,
                    letters: `Asocia las letras con sus sonidos. Etapa ${stage}`,
                    counting: `Cuenta los objetos correctamente. Etapa ${stage}`,
                    pattern: `Encuentra y completa el patr√≥n. Etapa ${stage}`,
                    words: `Forma las palabras correctas. Etapa ${stage}`,
                    comparison: `Compara los n√∫meros usando >, < o =. Etapa ${stage}`,
                    shapes: `Identifica las formas geom√©tricas. Etapa ${stage}`,
                    time: `Lee la hora correctamente. Etapa ${stage}`,
                    multiplication: `Resuelve las multiplicaciones. Etapa ${stage}`,
                    mental_math: `Calcula mentalmente lo m√°s r√°pido posible. Etapa ${stage}`,
                    fractions: `Trabaja con fracciones b√°sicas. Etapa ${stage}`,
                    word_puzzle: `Arma las palabras con las s√≠labas. Etapa ${stage}`,
                    logic: `Resuelve el problema l√≥gico. Etapa ${stage}`,
                    adventure: `Explora y resuelve los desaf√≠os. Etapa ${stage}`,
                    riddle: `Resuelve el acertijo presentado. Etapa ${stage}`,
                    crossword: `Completa el crucigrama num√©rico. Etapa ${stage}`,
                    default: `¬°Resuelve el desaf√≠o de la etapa ${stage}!`
                };
                
                return instructions[gameType] || instructions.default;
            }

            loadSpecificGame() {
                const playArea = document.getElementById('game-play-area');
                const gameType = this.currentGame.gameType;
                
                switch(gameType) {
                    case 'puzzle':
                        this.loadPuzzleGame(playArea);
                        break;
                    case 'memory':
                        this.loadMemoryGame(playArea);
                        break;
                    case 'math':
                    case 'mental_math':
                    case 'multiplication':
                        this.loadMathGame(playArea);
                        break;
                    case 'colors':
                        this.loadColorsGame(playArea);
                        break;
                    case 'sequence':
                    case 'pattern':
                        this.loadSequenceGame(playArea);
                        break;
                    case 'letters':
                        this.loadLettersGame(playArea);
                        break;
                    case 'counting':
                        this.loadCountingGame(playArea);
                        break;
                    case 'comparison':
                        this.loadComparisonGame(playArea);
                        break;
                    case 'shapes':
                        this.loadShapesGame(playArea);
                        break;
                    case 'fractions':
                        this.loadFractionsGame(playArea);
                        break;
                    case 'word_puzzle':
                    case 'words':
                        this.loadWordGame(playArea);
                        break;
                    case 'logic':
                    case 'riddle':
                        this.loadLogicGame(playArea);
                        break;
                    default:
                        this.loadDefaultGame(playArea);
                        break;
                }
            }

            // JUEGOS ESPEC√çFICOS

            loadPuzzleGame(container) {
                const maxNumber = Math.min(10, this.currentStage + 2);
                const numbers = Array.from({length: maxNumber}, (_, i) => i + 1);
                this.shuffleArray(numbers);

                this.gameState = {
                    correctOrder: Array.from({length: maxNumber}, (_, i) => i + 1),
                    currentOrder: [...numbers],
                    completed: []
                };

                container.innerHTML = `
                    <div class="question-display">Ordena los n√∫meros del 1 al ${maxNumber}</div>
                    <div class="game-grid puzzle-grid" id="puzzle-grid"></div>
                `;

                const grid = document.getElementById('puzzle-grid');
                numbers.forEach((num, index) => {
                    const btn = document.createElement('button');
                    btn.className = 'game-btn';
                    btn.textContent = num;
                    btn.onclick = () => this.handlePuzzleClick(btn, num, index);
                    grid.appendChild(btn);
                });
            }

            handlePuzzleClick(btn, number, index) {
                const expectedNext = this.gameState.completed.length + 1;
                
                if (number === expectedNext) {
                    btn.classList.add('correct');
                    this.gameState.completed.push(number);
                    this.currentScore += 10;
                    this.updateGameHeader();

                    if (this.gameState.completed.length === this.gameState.correctOrder.length) {
                        setTimeout(() => this.completeStage(), 500);
                    }
                } else {
                    btn.classList.add('incorrect');
                    setTimeout(() => btn.classList.remove('incorrect'), 600);
                    this.currentScore = Math.max(0, this.currentScore - 5);
                    this.updateGameHeader();
                }
            }

            loadMemoryGame(container) {
                const sequenceLength = Math.min(8, this.currentStage + 2);
                const colors = ['red', 'blue', 'green', 'yellow', 'purple', 'orange'];
                const sequence = Array.from({length: sequenceLength}, () => 
                    colors[Math.floor(Math.random() * colors.length)]
                );

                this.gameState = {
                    sequence: sequence,
                    playerSequence: [],
                    currentIndex: 0,
                    showing: true
                };

                container.innerHTML = `
                    <div class="question-display">Memoriza la secuencia de colores</div>
                    <div class="game-grid memory-grid" id="memory-grid"></div>
                    <div style="text-align: center; margin-top: 20px;">
                        <button class="modal-btn" onclick="app.startMemorySequence()">Ver Secuencia</button>
                    </div>
                `;

                const grid = document.getElementById('memory-grid');
                colors.slice(0, 6).forEach(color => {
                    const btn = document.createElement('button');
                    btn.className = `game-btn color-${color}`;
                    btn.onclick = () => this.handleMemoryClick(color);
                    grid.appendChild(btn);
                });
            }

            startMemorySequence() {
                const buttons = document.querySelectorAll('#memory-grid .game-btn');
                let index = 0;

                const showNext = () => {
                    if (index < this.gameState.sequence.length) {
                        const color = this.gameState.sequence[index];
                        const btn = document.querySelector(`.color-${color}`);
                        btn.classList.add('revealed');
                        
                        setTimeout(() => {
                            btn.classList.remove('revealed');
                            index++;
                            setTimeout(showNext, 300);
                        }, 600);
                    } else {
                        this.gameState.showing = false;
                        document.querySelector('.question-display').textContent = 'Repite la secuencia';
                    }
                };

                showNext();
            }

            handleMemoryClick(color) {
                if (this.gameState.showing) return;

                this.gameState.playerSequence.push(color);
                const currentIndex = this.gameState.playerSequence.length - 1;

                if (color === this.gameState.sequence[currentIndex]) {
                    this.currentScore += 15;
                    this.updateGameHeader();

                    if (this.gameState.playerSequence.length === this.gameState.sequence.length) {
                        setTimeout(() => this.completeStage(), 500);
                    }
                } else {
                    this.showNotification('Secuencia incorrecta. Int√©ntalo de nuevo.', 'error');
                    this.gameState.playerSequence = [];
                    this.currentScore = Math.max(0, this.currentScore - 10);
                    this.updateGameHeader();
                }
            }

            loadMathGame(container) {
                const difficulty = this.currentStage;
                let problems = [];

                // Generar problemas seg√∫n el tipo de juego y dificultad
                if (this.currentGame.gameType === 'multiplication') {
                    // Tablas de multiplicar
                    const tables = Math.min(10, Math.floor(difficulty / 2) + 2);
                    for (let i = 0; i < 5; i++) {
                        const a = Math.floor(Math.random() * tables) + 1;
                        const b = Math.floor(Math.random() * 10) + 1;
                        problems.push({
                            question: `${a} √ó ${b}`,
                            answer: a * b,
                            options: this.generateMathOptions(a * b)
                        });
                    }
                } else {
                    // Sumas y restas b√°sicas
                    const maxNum = Math.min(100, difficulty * 10);
                    for (let i = 0; i < 5; i++) {
                        const a = Math.floor(Math.random() * maxNum) + 1;
                        const b = Math.floor(Math.random() * maxNum) + 1;
                        const operation = Math.random() > 0.5 ? '+' : '-';
                        const answer = operation === '+' ? a + b : Math.max(a - b, 0);
                        problems.push({
                            question: `${a} ${operation} ${b}`,
                            answer: answer,
                            options: this.generateMathOptions(answer)
                        });
                    }
                }

                this.gameState = {
                    problems: problems,
                    currentProblem: 0,
                    correctAnswers: 0
                };

                this.showMathProblem(container);
            }

            generateMathOptions(correct) {
                const options = [correct];
                while (options.length < 4) {
                    const wrong = correct + (Math.floor(Math.random() * 20) - 10);
                    if (wrong !== correct && wrong >= 0 && !options.includes(wrong)) {
                        options.push(wrong);
                    }
                }
                this.shuffleArray(options);
                return options;
            }

            showMathProblem(container) {
                const problem = this.gameState.problems[this.gameState.currentProblem];
                
                container.innerHTML = `
                    <div class="question-display">${problem.question} = ?</div>
                    <div class="game-grid" style="grid-template-columns: repeat(2, 1fr); max-width: 400px;">
                        ${problem.options.map(option => 
                            `<button class="game-btn" onclick="app.handleMathAnswer(${option})">${option}</button>`
                        ).join('')}
                    </div>
                    <div style="text-align: center; margin-top: 20px;">
                        Problema ${this.gameState.currentProblem + 1} de ${this.gameState.problems.length}
                    </div>
                `;
            }

            handleMathAnswer(answer) {
                const problem = this.gameState.problems[this.gameState.currentProblem];
                const buttons = document.querySelectorAll('#game-content .game-btn');
                
                if (answer === problem.answer) {
                    this.gameState.correctAnswers++;
                    this.currentScore += 20;
                    buttons.forEach(btn => {
                        if (parseInt(btn.textContent) === answer) {
                            btn.classList.add('correct');
                        }
                    });
                } else {
                    buttons.forEach(btn => {
                        if (parseInt(btn.textContent) === answer) {
                            btn.classList.add('incorrect');
                        } else if (parseInt(btn.textContent) === problem.answer) {
                            btn.classList.add('correct');
                        }
                    });
                }

                this.updateGameHeader();

                setTimeout(() => {
                    this.gameState.currentProblem++;
                    if (this.gameState.currentProblem < this.gameState.problems.length) {
                        this.showMathProblem(document.getElementById('game-play-area'));
                    } else {
                        if (this.gameState.correctAnswers >= 3) {
                            this.completeStage();
                        } else {
                            this.showNotification('Necesitas al menos 3 respuestas correctas. ¬°Int√©ntalo de nuevo!', 'error');
                            setTimeout(() => this.loadGameContent(), 1500);
                        }
                    }
                }, 1500);
            }

            loadColorsGame(container) {
                const colors = ['red', 'blue', 'green', 'yellow', 'purple', 'orange'];
                const targetColor = colors[Math.floor(Math.random() * colors.length)];
                const gridSize = Math.min(6, this.currentStage + 2);
                
                this.gameState = {
                    targetColor: targetColor,
                    found: 0,
                    total: Math.floor(gridSize / 2) + 1
                };

                const colorNames = {
                    red: 'Rojo',
                    blue: 'Azul', 
                    green: 'Verde',
                    yellow: 'Amarillo',
                    purple: 'Morado',
                    orange: 'Naranja'
                };

                container.innerHTML = `
                    <div class="question-display">Encuentra todos los objetos de color ${colorNames[targetColor]}</div>
                    <div class="game-grid colors-grid" id="colors-grid"></div>
                `;

                const grid = document.getElementById('colors-grid');
                
                // Crear botones con colores aleatorios, asegurando que haya suficientes del color objetivo
                for (let i = 0; i < gridSize; i++) {
                    const btn = document.createElement('button');
                    btn.className = 'game-btn';
                    
                    let color;
                    if (i < this.gameState.total) {
                        color = targetColor;
                    } else {
                        do {
                            color = colors[Math.floor(Math.random() * colors.length)];
                        } while (color === targetColor);
                    }
                    
                    btn.classList.add(`color-${color}`);
                    btn.onclick = () => this.handleColorClick(btn, color);
                    grid.appendChild(btn);
                }

                // Mezclar los botones
                const buttons = [...grid.children];
                this.shuffleArray(buttons);
                buttons.forEach(btn => grid.appendChild(btn));
            }

            handleColorClick(btn, color) {
                if (color === this.gameState.targetColor) {
                    btn.classList.add('correct');
                    this.gameState.found++;
                    this.currentScore += 15;
                    
                    if (this.gameState.found >= this.gameState.total) {
                        setTimeout(() => this.completeStage(), 500);
                    }
                } else {
                    btn.classList.add('incorrect');
                    this.currentScore = Math.max(0, this.currentScore - 5);
                }
                
                this.updateGameHeader();
                btn.disabled = true;
            }

            loadSequenceGame(container) {
                const sequences = [
                    [1, 2, 3, 4, '?'], // Respuesta: 5
                    [2, 4, 6, 8, '?'], // Respuesta: 10
                    [1, 1, 2, 3, 5, '?'], // Fibonacci - Respuesta: 8
                    [10, 9, 8, 7, '?'], // Respuesta: 6
                    [1, 4, 9, 16, '?'], // Cuadrados - Respuesta: 25
                    [3, 6, 9, 12, '?'], // Respuesta: 15
                ];
                
                const answers = [5, 10, 8, 6, 25, 15];
                const sequenceIndex = Math.min(this.currentStage - 1, sequences.length - 1);
                const sequence = sequences[sequenceIndex];
                const correctAnswer = answers[sequenceIndex];

                this.gameState = {
                    sequence: sequence,
                    correctAnswer: correctAnswer,
                    options: this.generateSequenceOptions(correctAnswer)
                };

                container.innerHTML = `
                    <div class="question-display">¬øQu√© n√∫mero contin√∫a la secuencia?</div>
                    <div style="text-align: center; margin: 30px 0;">
                        <div style="font-size: 2em; color: #2d3436; font-weight: bold;">
                            ${sequence.join(' - ')}
                        </div>
                    </div>
                    <div class="game-grid" style="grid-template-columns: repeat(2, 1fr); max-width: 400px;">
                        ${this.gameState.options.map(option => 
                            `<button class="game-btn" onclick="app.handleSequenceAnswer(${option})">${option}</button>`
                        ).join('')}
                    </div>
                `;
            }

            generateSequenceOptions(correct) {
                const options = [correct];
                while (options.length < 4) {
                    const wrong = correct + (Math.floor(Math.random() * 10) - 5);
                    if (wrong !== correct && wrong > 0 && !options.includes(wrong)) {
                        options.push(wrong);
                    }
                }
                this.shuffleArray(options);
                return options;
            }

            handleSequenceAnswer(answer) {
                const buttons = document.querySelectorAll('#game-content .game-btn');
                
                if (answer === this.gameState.correctAnswer) {
                    buttons.forEach(btn => {
                        if (parseInt(btn.textContent) === answer) {
                            btn.classList.add('correct');
                        }
                    });
                    this.currentScore += 25;
                    setTimeout(() => this.completeStage(), 1000);
                } else {
                    buttons.forEach(btn => {
                        if (parseInt(btn.textContent) === answer) {
                            btn.classList.add('incorrect');
                        } else if (parseInt(btn.textContent) === this.gameState.correctAnswer) {
                            btn.classList.add('correct');
                        }
                    });
                    this.currentScore = Math.max(0, this.currentScore - 10);
                    setTimeout(() => this.loadGameContent(), 2000);
                }
                
                this.updateGameHeader();
            }

            loadLettersGame(container) {
                const letters = ['A', 'E', 'I', 'O', 'U', 'B', 'C', 'D', 'F', 'G'];
                const targetLetter = letters[Math.floor(Math.random() * letters.length)];
                const isVowel = ['A', 'E', 'I', 'O', 'U'].includes(targetLetter);

                this.gameState = {
                    targetLetter: targetLetter,
                    isVowel: isVowel
                };

                container.innerHTML = `
                    <div class="question-display">Encuentra la letra "${targetLetter}" y di si es vocal o consonante</div>
                    <div style="text-align: center; margin: 30px 0;">
                        <div style="font-size: 4em; color: #2d3436; font-weight: bold;">${targetLetter}</div>
                    </div>
                    <div class="game-grid" style="grid-template-columns: repeat(2, 1fr); max-width: 400px;">
                        <button class="game-btn" onclick="app.handleLetterAnswer(true)">Es Vocal</button>
                        <button class="game-btn" onclick="app.handleLetterAnswer(false)">Es Consonante</button>
                    </div>
                `;
            }

            handleLetterAnswer(isVowelGuess) {
                const buttons = document.querySelectorAll('#game-content .game-btn');
                
                if (isVowelGuess === this.gameState.isVowel) {
                    buttons[isVowelGuess ? 0 : 1].classList.add('correct');
                    this.currentScore += 20;
                    setTimeout(() => this.completeStage(), 1000);
                } else {
                    buttons[isVowelGuess ? 0 : 1].classList.add('incorrect');
                    buttons[isVowelGuess ? 1 : 0].classList.add('correct');
                    this.currentScore = Math.max(0, this.currentScore - 10);
                    setTimeout(() => this.loadGameContent(), 2000);
                }
                
                this.updateGameHeader();
            }

            loadCountingGame(container) {
                const maxCount = Math.min(20, this.currentStage * 3);
                const correctCount = Math.floor(Math.random() * maxCount) + 1;
                const emoji = ['üçé', 'üê∂', '‚≠ê', 'üéà', 'üèÄ'][Math.floor(Math.random() * 5)];

                this.gameState = {
                    correctCount: correctCount,
                    options: this.generateCountOptions(correctCount)
                };

                const objects = Array(correctCount).fill(emoji).join(' ');

                container.innerHTML = `
                    <div class="question-display">¬øCu√°ntos objetos hay?</div>
                    <div style="text-align: center; margin: 30px 0; font-size: 2em; line-height: 1.5;">
                        ${objects}
                    </div>
                    <div class="game-grid" style="grid-template-columns: repeat(2, 1fr); max-width: 400px;">
                        ${this.gameState.options.map(option => 
                            `<button class="game-btn" onclick="app.handleCountAnswer(${option})">${option}</button>`
                        ).join('')}
                    </div>
                `;
            }

            generateCountOptions(correct) {
                const options = [correct];
                while (options.length < 4) {
                    const wrong = correct + (Math.floor(Math.random() * 6) - 3);
                    if (wrong !== correct && wrong > 0 && !options.includes(wrong)) {
                        options.push(wrong);
                    }
                }
                this.shuffleArray(options);
                return options;
            }

            handleCountAnswer(answer) {
                const buttons = document.querySelectorAll('#game-content .game-btn');
                
                if (answer === this.gameState.correctCount) {
                    buttons.forEach(btn => {
                        if (parseInt(btn.textContent) === answer) {
                            btn.classList.add('correct');
                        }
                    });
                    this.currentScore += 15;
                    setTimeout(() => this.completeStage(), 1000);
                } else {
                    buttons.forEach(btn => {
                        if (parseInt(btn.textContent) === answer) {
                            btn.classList.add('incorrect');
                        } else if (parseInt(btn.textContent) === this.gameState.correctCount) {
                            btn.classList.add('correct');
                        }
                    });
                    this.currentScore = Math.max(0, this.currentScore - 5);
                    setTimeout(() => this.loadGameContent(), 2000);
                }
                
                this.updateGameHeader();
            }

            loadComparisonGame(container) {
                const maxNum = Math.min(100, this.currentStage * 10);
                const num1 = Math.floor(Math.random() * maxNum) + 1;
                const num2 = Math.floor(Math.random() * maxNum) + 1;
                
                let correctAnswer;
                if (num1 > num2) correctAnswer = '>';
                else if (num1 < num2) correctAnswer = '<';
                else correctAnswer = '=';

                this.gameState = {
                    num1: num1,
                    num2: num2,
                    correctAnswer: correctAnswer
                };

                container.innerHTML = `
                    <div class="question-display">¬øQu√© s√≠mbolo va entre los n√∫meros?</div>
                    <div style="text-align: center; margin: 30px 0; font-size: 3em; color: #2d3436; font-weight: bold;">
                        ${num1} ___ ${num2}
                    </div>
                    <div class="game-grid" style="grid-template-columns: repeat(3, 1fr); max-width: 450px;">
                        <button class="game-btn" onclick="app.handleComparisonAnswer('>')" style="font-size: 2em;">&gt;</button>
                        <button class="game-btn" onclick="app.handleComparisonAnswer('<')" style="font-size: 2em;">&lt;</button>
                        <button class="game-btn" onclick="app.handleComparisonAnswer('=')" style="font-size: 2em;">=</button>
                    </div>
                `;
            }

            handleComparisonAnswer(answer) {
                const buttons = document.querySelectorAll('#game-content .game-btn');
                
                if (answer === this.gameState.correctAnswer) {
                    buttons.forEach(btn => {
                        if (btn.textContent.includes(answer)) {
                            btn.classList.add('correct');
                        }
                    });
                    this.currentScore += 15;
                    setTimeout(() => this.completeStage(), 1000);
                } else {
                    buttons.forEach(btn => {
                        if (btn.textContent.includes(answer)) {
                            btn.classList.add('incorrect');
                        } else if (btn.textContent.includes(this.gameState.correctAnswer)) {
                            btn.classList.add('correct');
                        }
                    });
                    this.currentScore = Math.max(0, this.currentScore - 5);
                    setTimeout(() => this.loadGameContent(), 2000);
                }
                
                this.updateGameHeader();
            }

            loadShapesGame(container) {
                const shapes = [
                    { name: 'C√≠rculo', emoji: 'üî¥', sides: 0 },
                    { name: 'Tri√°ngulo', emoji: 'üî∫', sides: 3 },
                    { name: 'Cuadrado', emoji: 'üü¶', sides: 4 },
                    { name: 'Pent√°gono', emoji: '‚¨ü', sides: 5 },
                    { name: 'Hex√°gono', emoji: '‚¨°', sides: 6 }
                ];

                const targetShape = shapes[Math.floor(Math.random() * shapes.length)];
                const otherShapes = shapes.filter(s => s !== targetShape);
                this.shuffleArray(otherShapes);
                const options = [targetShape, ...otherShapes.slice(0, 3)];
                this.shuffleArray(options);

                this.gameState = {
                    targetShape: targetShape,
                    options: options
                };

                container.innerHTML = `
                    <div class="question-display">Encuentra la forma: ${targetShape.name}</div>
                    <div class="game-grid shapes-grid" id="shapes-grid">
                        ${options.map(shape => 
                            `<button class="game-btn" onclick="app.handleShapeAnswer('${shape.name}')" style="font-size: 3em;">${shape.emoji}</button>`
                        ).join('')}
                    </div>
                `;
            }

            handleShapeAnswer(shapeName) {
                const buttons = document.querySelectorAll('#game-content .game-btn');
                
                if (shapeName === this.gameState.targetShape.name) {
                    buttons.forEach(btn => {
                        if (btn.onclick.toString().includes(shapeName)) {
                            btn.classList.add('correct');
                        }
                    });
                    this.currentScore += 20;
                    setTimeout(() => this.completeStage(), 1000);
                } else {
                    buttons.forEach(btn => {
                        if (btn.onclick.toString().includes(shapeName)) {
                            btn.classList.add('incorrect');
                        } else if (btn.onclick.toString().includes(this.gameState.targetShape.name)) {
                            btn.classList.add('correct');
                        }
                    });
                    this.currentScore = Math.max(0, this.currentScore - 10);
                    setTimeout(() => this.loadGameContent(), 2000);
                }
                
                this.updateGameHeader();
            }

            loadFractionsGame(container) {
                const fractions = [
                    { display: '1/2', value: 0.5, visual: 'üç∞üç∞' },
                    { display: '1/3', value: 0.33, visual: 'üç∞üç∞üç∞' },
                    { display: '1/4', value: 0.25, visual: 'üç∞üç∞üç∞üç∞' },
                    { display: '2/3', value: 0.67, visual: 'üç∞üç∞üç∞' },
                    { display: '3/4', value: 0.75, visual: 'üç∞üç∞üç∞üç∞' }
                ];

                const targetFraction = fractions[Math.floor(Math.random() * fractions.length)];
                const options = this.generateFractionOptions(targetFraction);

                this.gameState = {
                    targetFraction: targetFraction,
                    options: options
                };

                container.innerHTML = `
                    <div class="question-display">¬øCu√°l fracci√≥n representa ${targetFraction.display}?</div>
                    <div style="text-align: center; margin: 30px 0; font-size: 2em;">
                        ${targetFraction.visual}
                    </div>
                    <div class="game-grid" style="grid-template-columns: repeat(2, 1fr); max-width: 400px;">
                        ${options.map(fraction => 
                            `<button class="game-btn" onclick="app.handleFractionAnswer('${fraction.display}')">${fraction.display}</button>`
                        ).join('')}
                    </div>
                `;
            }

            generateFractionOptions(correct) {
                const allFractions = [
                    { display: '1/2', value: 0.5 },
                    { display: '1/3', value: 0.33 },
                    { display: '1/4', value: 0.25 },
                    { display: '2/3', value: 0.67 },
                    { display: '3/4', value: 0.75 }
                ];
                
                const options = [correct];
                const others = allFractions.filter(f => f.display !== correct.display);
                this.shuffleArray(others);
                options.push(...others.slice(0, 3));
                this.shuffleArray(options);
                return options;
            }

            handleFractionAnswer(fractionDisplay) {
                const buttons = document.querySelectorAll('#game-content .game-btn');
                
                if (fractionDisplay === this.gameState.targetFraction.display) {
                    buttons.forEach(btn => {
                        if (btn.textContent === fractionDisplay) {
                            btn.classList.add('correct');
                        }
                    });
                    this.currentScore += 25;
                    setTimeout(() => this.completeStage(), 1000);
                } else {
                    buttons.forEach(btn => {
                        if (btn.textContent === fractionDisplay) {
                            btn.classList.add('incorrect');
                        } else if (btn.textContent === this.gameState.targetFraction.display) {
                            btn.classList.add('correct');
                        }
                    });
                    this.currentScore = Math.max(0, this.currentScore - 10);
                    setTimeout(() => this.loadGameContent(), 2000);
                }
                
                this.updateGameHeader();
            }

            loadWordGame(container) {
                const words = [
                    { word: 'CASA', syllables: ['CA', 'SA'] },
                    { word: 'PERRO', syllables: ['PE', 'RRO'] },
                    { word: 'MARIPOSA', syllables: ['MA', 'RI', 'PO', 'SA'] },
                    { word: 'GATO', syllables: ['GA', 'TO'] },
                    { word: 'ESCUELA', syllables: ['ES', 'CUE', 'LA'] }
                ];

                const targetWord = words[Math.floor(Math.random() * words.length)];
                const shuffledSyllables = [...targetWord.syllables];
                this.shuffleArray(shuffledSyllables);

                this.gameState = {
                    targetWord: targetWord,
                    selectedSyllables: [],
                    availableSyllables: [...shuffledSyllables]
                };

                container.innerHTML = `
                    <div class="question-display">Forma la palabra: ${targetWord.word}</div>
                    <div style="text-align: center; margin: 30px 0;">
                        <div id="word-building" style="font-size: 2em; min-height: 60px; border: 2px dashed #ccc; padding: 20px; border-radius: 10px;">
                            ${this.gameState.selectedSyllables.join('')}
                        </div>
                    </div>
                    <div class="game-grid" style="grid-template-columns: repeat(3, 1fr); max-width: 450px;" id="syllables-grid">
                        ${shuffledSyllables.map((syllable, index) => 
                            `<button class="game-btn" onclick="app.handleSyllableClick('${syllable}', ${index})" id="syl-${index}">${syllable}</button>`
                        ).join('')}
                    </div>
                    <div style="text-align: center; margin-top: 20px;">
                        <button class="modal-btn" onclick="app.resetWord()">Reiniciar</button>
                    </div>
                `;
            }

            handleSyllableClick(syllable, index) {
                if (this.gameState.selectedSyllables.length < this.gameState.targetWord.syllables.length) {
                    this.gameState.selectedSyllables.push(syllable);
                    document.getElementById(`syl-${index}`).disabled = true;
                    document.getElementById(`syl-${index}`).style.opacity = '0.5';
                    
                    document.getElementById('word-building').textContent = this.gameState.selectedSyllables.join('');
                    
                    if (this.gameState.selectedSyllables.length === this.gameState.targetWord.syllables.length) {
                        const formedWord = this.gameState.selectedSyllables.join('');
                        if (formedWord === this.gameState.targetWord.word) {
                            this.currentScore += 30;
                            this.updateGameHeader();
                            setTimeout(() => this.completeStage(), 1000);
                        } else {
                            this.showNotification('Palabra incorrecta. Int√©ntalo de nuevo.', 'error');
                            setTimeout(() => this.resetWord(), 1500);
                        }
                    }
                }
            }

            resetWord() {
                this.gameState.selectedSyllables = [];
                document.getElementById('word-building').textContent = '';
                
                const buttons = document.querySelectorAll('#syllables-grid .game-btn');
                buttons.forEach(btn => {
                    btn.disabled = false;
                    btn.style.opacity = '1';
                });
            }

            loadLogicGame(container) {
                const riddles = [
                    {
                        question: "Si tienes 3 manzanas y comes 2, ¬øcu√°ntas te quedan?",
                        answer: "1",
                        options: ["0", "1", "2", "3"]
                    },
                    {
                        question: "¬øQu√© n√∫mero viene despu√©s del 7 en esta secuencia: 2, 4, 6, 7, ...?",
                        answer: "8",
                        options: ["7", "8", "9", "10"]
                    },
                    {
                        question: "Si llueve, me mojo. Estoy mojado, ¬øqu√© pas√≥?",
                        answer: "Llovi√≥",
                        options: ["Llovi√≥", "Hizo sol", "Nev√≥", "Graniz√≥"]
                    }
                ];

                const riddle = riddles[Math.min(this.currentStage - 1, riddles.length - 1)];
                this.gameState = { riddle: riddle };

                container.innerHTML = `
                    <div class="question-display">${riddle.question}</div>
                    <div class="game-grid" style="grid-template-columns: repeat(2, 1fr); max-width: 500px;">
                        ${riddle.options.map(option => 
                            `<button class="game-btn" onclick="app.handleRiddleAnswer('${option}')" style="font-size: 1.2em;">${option}</button>`
                        ).join('')}
                    </div>
                `;
            }

            handleRiddleAnswer(answer) {
                const buttons = document.querySelectorAll('#game-content .game-btn');
                
                if (answer === this.gameState.riddle.answer) {
                    buttons.forEach(btn => {
                        if (btn.textContent === answer) {
                            btn.classList.add('correct');
                        }
                    });
                    this.currentScore += 35;
                    setTimeout(() => this.completeStage(), 1000);
                } else {
                    buttons.forEach(btn => {
                        if (btn.textContent === answer) {
                            btn.classList.add('incorrect');
                        } else if (btn.textContent === this.gameState.riddle.answer) {
                            btn.classList.add('correct');
                        }
                    });
                    this.currentScore = Math.max(0, this.currentScore - 15);
                    setTimeout(() => this.loadGameContent(), 2000);
                }
                
                this.updateGameHeader();
            }

            loadDefaultGame(container) {
                container.innerHTML = `
                    <div class="question-display">¬°Completa este desaf√≠o especial!</div>
                    <div style="text-align: center; padding: 50px;">
                        <div style="font-size: 4em; margin-bottom: 30px;">üéØ</div>
                        <p style="font-size: 1.3em; color: #636e72; margin-bottom: 30px;">
                            Este es un juego especial. ¬°Presiona el bot√≥n para ganar puntos!
                        </p>
                        <button class="game-btn" onclick="app.handleDefaultGame()" style="width: 200px; height: 80px;">
                            ¬°Completar!
                        </button>
                    </div>
                `;
            }

            handleDefaultGame() {
                this.currentScore += 50;
                this.updateGameHeader();
                setTimeout(() => this.completeStage(), 500);
            }

            // UTILIDADES

            shuffleArray(array) {
                for (let i = array.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [array[i], array[j]] = [array[j], array[i]];
                }
            }

            // GESTI√ìN DE ETAPAS Y PROGRESO

            completeStage() {
                const timeBonus = Math.max(0, 100 - Math.floor((Date.now() - this.gameStartTime) / 1000));
                this.currentScore += timeBonus;
                
                // Actualizar progreso del usuario
                if (!this.currentUser.progress[this.currentGame.id]) {
                    this.currentUser.progress[this.currentGame.id] = { stage: 1, completed: false, bestScore: 0 };
                }
                
                const gameProgress = this.currentUser.progress[this.currentGame.id];
                gameProgress.bestScore = Math.max(gameProgress.bestScore, this.currentScore);
                
                if (this.currentStage >= this.currentGame.stages) {
                    gameProgress.completed = true;
                    this.currentUser.gamesCompleted++;
                }
                
                if (this.currentStage < this.currentGame.stages) {
                    gameProgress.stage = this.currentStage + 1;
                }
                
                this.currentUser.totalScore += this.currentScore;
                this.currentUser.level = Math.floor(this.currentUser.totalScore / 1000) + 1;
                this.currentUser.coins += Math.floor(this.currentScore / 10);
                
                this.saveUserData(this.currentUser);
                
                // Mostrar modal de √©xito
                document.getElementById('modal-message').textContent = 
                    `¬°Etapa ${this.currentStage} completada! Puntos: ${this.currentScore} ${timeBonus > 0 ? `(+${timeBonus} bonus de tiempo)` : ''}`;
                document.getElementById('success-modal').style.display = 'block';
            }

            nextStage() {
                this.closeModal();
                if (this.currentStage < this.currentGame.stages) {
                    this.currentStage++;
                    this.currentScore = 0;
                    this.gameStartTime = Date.now();
                    this.updateGameHeader();
                    this.loadGameContent();
                } else {
                    this.backToDashboard();
                }
            }

            playAgain() {
                this.closeModal();
                this.currentScore = 0;
                this.gameStartTime = Date.now();
                this.updateGameHeader();
                this.loadGameContent();
            }

            closeModal() {
                document.getElementById('success-modal').style.display = 'none';
            }

            backToDashboard() {
                document.getElementById('game-area').classList.remove('active');
                this.showDashboard();
            }

            // SELECCI√ìN DE ETAPAS

            showStageSelector() {
                const modal = document.getElementById('stage-modal');
                const grid = document.getElementById('stages-grid');
                const gameProgress = this.currentUser.progress[this.currentGame.id] || { stage: 1, completed: false };
                
                grid.innerHTML = '';
                
                for (let i = 1; i <= this.currentGame.stages; i++) {
                    const btn = document.createElement('button');
                    btn.className = 'stage-btn';
                    btn.textContent = `Etapa ${i}`;
                    
                    if (i < gameProgress.stage) {
                        btn.classList.add('completed');
                    } else if (i > gameProgress.stage) {
                        btn.disabled = true;
                    }
                    
                    btn.onclick = () => this.selectStage(i);
                    grid.appendChild(btn);
                }
                
                // Actualizar barra de progreso
                const progressPercentage = ((gameProgress.stage - 1) / this.currentGame.stages) * 100;
                document.getElementById('game-progress-fill').style.width = `${progressPercentage}%`;
                document.getElementById('stage-progress-text').textContent = 
                    `${gameProgress.stage - 1}/${this.currentGame.stages} etapas completadas`;
                
                modal.style.display = 'block';
            }

            selectStage(stageNumber) {
                this.currentStage = stageNumber;
                this.currentScore = 0;
                this.gameStartTime = Date.now();
                this.updateGameHeader();
                this.loadGameContent();
                this.closeStageModal();
            }

            closeStageModal() {
                document.getElementById('stage-modal').style.display = 'none';
            }

            // GESTI√ìN DE DATOS

            saveUserData(userData) {
                const users = JSON.parse(localStorage.getItem('eduplay_users') || '{}');
                users[userData.username] = userData;
                localStorage.setItem('eduplay_users', JSON.stringify(users));
            }

            loadUserData(username = null) {
                const users = JSON.parse(localStorage.getItem('eduplay_users') || '{}');
                if (username) {
                    return users[username] || null;
                }
                return users;
            }

            // NOTIFICACIONES

            showNotification(message, type = 'info') {
                const notification = document.createElement('div');
                notification.className = `notification ${type}`;
                notification.textContent = message;
                document.body.appendChild(notification);
                
                setTimeout(() => {
                    notification.remove();
                }, 3000);
            }

            // LOGOUT

            logout() {
                this.currentUser = null;
                this.currentGame = null;
                this.currentStage = 1;
                this.currentScore = 0;
                this.showLoginScreen();
                this.showNotification('Sesi√≥n cerrada exitosamente', 'info');
            }
        }

        // Inicializar la aplicaci√≥n
        const app = new EduPlayApp();
        
    </script>
</body>
</html>